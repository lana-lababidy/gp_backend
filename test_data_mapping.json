{
  "test_name": "AI Service Data Mapping Verification",
  "description": "This file shows exactly what data we send to the AI service and verifies the mapping is correct",
  
  "database_schema": {
    "request_cases_table": {
      "id": "integer - Primary key",
      "title": "string - Request title",
      "description": "string - Detailed description",
      "userName": "string - School/Organization name",
      "mobile_number": "bigInteger - Contact number",
      "importance": "integer - Priority level 1-5",
      "goal_quantity": "integer - Target amount/quantity",
      "fulfilled_quantity": "integer - Amount completed so far",
      "status": "string - Request status (pending, approved, etc)",
      "user_id": "foreign key to users table",
      "created_at": "timestamp",
      "updated_at": "timestamp"
    }
  },

  "sample_database_records": [
    {
      "id": 1,
      "title": "إصلاح طارئ لسقف المدرسة",
      "description": "نحتاج إلى إصلاح عاجل لسقف الفصل الدراسي الرئيسي بسبب التسرب المستمر للمياه خلال فصل الشتاء. هذا يؤثر على سلامة الطلاب وجودة التعليم. الوضع خطير جداً.",
      "userName": "مدرسة النور الابتدائية",
      "mobile_number": 966501111111,
      "importance": 5,
      "goal_quantity": 15000,
      "fulfilled_quantity": 2500,
      "status": "pending",
      "user_id": 1,
      "user": {
        "username": "ahmad_hassan",
        "aliasname": "أحمد حسن"
      }
    },
    {
      "id": 2,
      "title": "Emergency Window Replacement", 
      "description": "Broken classroom windows pose immediate safety risk to students. Sharp glass fragments everywhere. Need urgent replacement before classes resume tomorrow.",
      "userName": "City Elementary School",
      "mobile_number": 966502222222,
      "importance": 5,
      "goal_quantity": 8000,
      "fulfilled_quantity": 1000,
      "status": "pending",
      "user_id": 2,
      "user": {
        "username": "fatima_ali",
        "aliasname": "فاطمة علي"
      }
    },
    {
      "id": 3,
      "title": "Library Book Collection",
      "description": "Would like to expand our school library with new educational books for grades 1-6. This will help improve reading skills.",
      "userName": "Green Valley Elementary",
      "mobile_number": 966504444444,
      "importance": 2,
      "goal_quantity": 5000,
      "fulfilled_quantity": 0,
      "status": "pending",
      "user_id": 1,
      "user": {
        "username": "ahmad_hassan", 
        "aliasname": "أحمد حسن"
      }
    }
  ],

  "laravel_formatting_process": {
    "step_1_calculate_completion": {
      "formula": "fulfilled_quantity / goal_quantity",
      "examples": {
        "request_1": "2500 / 15000 = 0.167 (16.7%)",
        "request_2": "1000 / 8000 = 0.125 (12.5%)", 
        "request_3": "0 / 5000 = 0.0 (0%)"
      }
    },
    "step_2_build_enhanced_description": {
      "components": [
        "Title: [original title]",
        "Description: [original description]", 
        "Goal: [goal_quantity] units needed, [fulfilled_quantity] units fulfilled so far",
        "Priority indicator based on importance level"
      ]
    },
    "step_3_format_for_ai": {
      "output_structure": "See ai_service_request_format below"
    }
  },

  "ai_service_request_format": {
    "auth_token": "aidranker_secure",
    "requests": [
      {
        "id": 1,
        "description": "Title: إصلاح طارئ لسقف المدرسة Description: نحتاج إلى إصلاح عاجل لسقف الفصل الدراسي الرئيسي بسبب التسرب المستمر للمياه خلال فصل الشتاء. هذا يؤثر على سلامة الطلاب وجودة التعليم. الوضع خطير جداً. Goal: 15000 units needed, 2500 units fulfilled so far. HIGH PRIORITY REQUEST - Immediate attention required.",
        "importance": 5,
        "percent_done": 0.167,
        "school": "مدرسة النور الابتدائية",
        "requested_by": "ahmad_hassan",
        "mobile_number": "966501111111",
        "status": "pending",
        "goal_quantity": 15000,
        "fulfilled_quantity": 2500,
        "created_at": "2025-09-09T20:00:00Z"
      },
      {
        "id": 2,
        "description": "Title: Emergency Window Replacement Description: Broken classroom windows pose immediate safety risk to students. Sharp glass fragments everywhere. Need urgent replacement before classes resume tomorrow. Goal: 8000 units needed, 1000 units fulfilled so far. HIGH PRIORITY REQUEST - Immediate attention required.",
        "importance": 5,
        "percent_done": 0.125,
        "school": "City Elementary School",
        "requested_by": "fatima_ali",
        "mobile_number": "966502222222",
        "status": "pending",
        "goal_quantity": 8000,
        "fulfilled_quantity": 1000,
        "created_at": "2025-09-09T20:00:00Z"
      },
      {
        "id": 3,
        "description": "Title: Library Book Collection Description: Would like to expand our school library with new educational books for grades 1-6. This will help improve reading skills. Goal: 5000 units needed, 0 units fulfilled so far.",
        "importance": 2,
        "percent_done": 0.0,
        "school": "Green Valley Elementary", 
        "requested_by": "ahmad_hassan",
        "mobile_number": "966504444444",
        "status": "pending",
        "goal_quantity": 5000,
        "fulfilled_quantity": 0,
        "created_at": "2025-09-09T20:00:00Z"
      }
    ]
  },

  "ai_service_expected_response": {
    "ranked_requests": [
      {
        "id": 1,
        "description": "Title: إصلاح طارئ لسقف المدرسة Description: نحتاج إلى إصلاح عاجل...",
        "percent_done": 0.167,
        "urgency_label": "High urgency",
        "urgency_score_model": 0.892,
        "urgency_score_aggressive": 1.041,
        "school": "مدرسة النور الابتدائية",
        "requested_by": "ahmad_hassan",
        "importance": 5,
        "mobile_number": "966501111111"
      },
      {
        "id": 2, 
        "description": "Title: Emergency Window Replacement Description: Broken classroom windows...",
        "percent_done": 0.125,
        "urgency_label": "High urgency",
        "urgency_score_model": 0.885,
        "urgency_score_aggressive": 0.996,
        "school": "City Elementary School",
        "requested_by": "fatima_ali",
        "importance": 5,
        "mobile_number": "966502222222"
      },
      {
        "id": 3,
        "description": "Title: Library Book Collection Description: Would like to expand our school library...",
        "percent_done": 0.0,
        "urgency_label": "Low urgency", 
        "urgency_score_model": 0.245,
        "urgency_score_aggressive": 0.245,
        "school": "Green Valley Elementary",
        "requested_by": "ahmad_hassan",
        "importance": 2,
        "mobile_number": "966504444444"
      }
    ]
  },

  "laravel_final_response": {
    "status": "success",
    "data": [
      {
        "id": 1,
        "title": "إصلاح طارئ لسقف المدرسة",
        "description": "نحتاج إلى إصلاح عاجل لسقف الفصل الدراسي...",
        "userName": "مدرسة النور الابتدائية",
        "importance": 5,
        "goal_quantity": 15000,
        "fulfilled_quantity": 2500,
        "status": "pending",
        "ai_ranking": {
          "urgency_label": "High urgency",
          "urgency_score_model": 0.892,
          "urgency_score_aggressive": 1.041,
          "is_fallback": false
        },
        "user": {
          "username": "ahmad_hassan",
          "aliasname": "أحمد حسن"
        }
      }
    ],
    "ai_service_healthy": true
  },

  "key_validations": {
    "completion_percentage": {
      "accurate": true,
      "formula_correct": "fulfilled_quantity / goal_quantity",
      "handles_zero_division": true,
      "handles_null_values": true
    },
    "data_types": {
      "id": "integer ✓",
      "importance": "integer (1-5) ✓", 
      "percent_done": "float (0.0-1.0) ✓",
      "quantities": "integer ✓",
      "strings": "properly encoded ✓"
    },
    "multilingual_support": {
      "arabic_text": "preserved correctly ✓",
      "english_text": "preserved correctly ✓", 
      "mixed_content": "handled properly ✓"
    },
    "ai_ranking_algorithm": {
      "uses_description_analysis": true,
      "uses_completion_percentage": true,
      "formula": "model_confidence * (1 + percent_done)",
      "sorts_by_aggressive_score": true,
      "higher_score_means_higher_priority": true
    }
  },

  "test_instructions": {
    "manual_test": [
      "1. Start AI service: cd ai_service && docker-compose up -d",
      "2. Wait 2-3 minutes for model to load",
      "3. Test health: curl http://localhost:5000/health",
      "4. Test ranking with sample data from this file",
      "5. Verify results match expected priority order"
    ],
    "automated_test": [
      "1. Run: php artisan migrate:fresh",
      "2. Run: php artisan db:seed --class=TestDataSeeder", 
      "3. Test API: POST /api/request-cases/pending",
      "4. Verify AI ranking is applied and results are sorted"
    ]
  }
}